---
- name: Install Packages
  hosts: localhost
  vars: 
    dnf_packages:
      - neovim
      - qt5-*
      - hack-fonts
      - jetbrains-mono-fonts
      - flatpak
    coprs:
      - solopasha/hyprland
      - matthickford/git-credential-manager 
      - zawertun/hack-fonts
      - elxreno/jetbrains-mono-fonts
    flatpacks:
      - com.logseq.Logseq
    wget_packages:
      zsh: https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh
  tasks:
    - name: Install Copr Packages
      community.general.copr:
        state: enabled
        name: "{{ item }}"
      loop: "{{ coprs }}"
    - name: Install Dnf Packages
      dnf:
        name: "{{ item }}"
        state: present
      loop: "{{ dnf_packages }}"
    - name: Install Apps from Wget
      get_url:
        dest: /tmp/{{ item.key }}.sh
        url: "{{ item.value }}"
        mode: '0744'
      loop: "{{ lookup('dict', wget_packages, wantlist=true) }}"
    - name: Add Flathub remote
      community.general.flatpak_remote:
        name: flathub
        state: present
        flatpakrepo_url: https://dl.flathub.org/repo/flathub.flatpakrepo
    - name: Install Flatpacks
      community.general.flatpak:
        name: "{{ item }}"
        state: present
      with_items: "{{ flatpacks }}"

- name: Configure Zsh
  hosts: localhost
  vars:
    user: tanchwa
  tasks:
    - name: Remove .Oh-My-Zsh File if it Exists
      file:
        path:  /home/{{ user }}/.oh-my-zsh
        state: absent
    - name: Install Oh-My-Zsh
      shell:
        cmd: /tmp/zsh.sh --unattended
      environment:
        KEEP_ZSHRC: yes
        ZSH: /home/{{ user }}/.oh-my-zsh
    - name: Change Oh-My-Zsh Dir Owner
      file: 
        path: /home/{{ user }}/.oh-my-zsh
        owner: "{{ user }}"
        group: "{{ user }}"
        recurse: true
        mode: '0755'

- name: Load Fonts
  hosts: localhost
  tasks:
    - name: Refresh Fonts
      shell:
        cmd: fc-cache -f -v

- name: Load Dot Configs
  hosts: localhost
  vars:
    dots_repo: https://github.com/tanchwa/dotfiles.git
    file_patterns:
      - .local
      - .config
      - .zshrc
  tasks:
    - name: Checkout Dotfiles
      git:
        repo: "{{ dots_repo }}"
        dest: /tmp/checkout
        force: true

    - name: Copy Dotfiles
      copy:
        src: /tmp/checkout/{{ item }}
        dest: /home/tanchwa
        owner: tanchwa
        group: tanchwa
        mode: '0755'
      with_items: "{{ file_patterns }}" 
      delegate_to: localhost


## INSTALL NON DEFAULT REPO PACKAGES ## 
#sudo dnf install dnf-plugins-core

#sudo dnf config-manager addrepo --from-repofile=https://brave-browser-rpm-release.s3.brave.com/brave-browser.repo

#sudo dnf install brave-browser
