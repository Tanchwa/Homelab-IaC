---
- hosts: controlplane_nodes, worker_nodes
  become: yes
  become_user: root
  tasks:
  - name: Ensure NFS-Utils is first installed
    apt:
      name: nfs-common
      state: present
      update_cache: yes
  - name: Mount NAS
    mount:
      src: 192.168.1.19:/mnt/Main/kubernetes
      path: /mnt/nfs
      opts: rw,sync,hard
      state: mounted
      fstype: nfs
  - name: Create NFS Mount Conf
    shell: |
      cat <<EOF > /etc/nfsmount.conf
      [ NFSMount_Global_Options ]
        Proto=tcp
        Defaultvers=4
      EOF
